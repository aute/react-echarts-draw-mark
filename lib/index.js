import e,{useState as n,useReducer as t,useEffect as r}from"react";import o from"echarts-for-react";import a from"echarts";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var c=function(){return(c=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)};function i(){for(var e=0,n=0,t=arguments.length;n<t;n++)e+=arguments[n].length;var r=Array(e),o=0;for(n=0;n<t;n++)for(var a=arguments[n],c=0,i=a.length;c<i;c++,o++)r[o]=a[c];return r}function u(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}function s(e){return function n(t){return 0===arguments.length||u(t)?n:e.apply(this,arguments)}}function l(e){return function n(t,r){switch(arguments.length){case 0:return n;case 1:return u(t)?n:s((function(n){return e(t,n)}));default:return u(t)&&u(r)?n:u(t)?s((function(n){return e(n,r)})):u(r)?s((function(n){return e(t,n)})):e(t,r)}}}function f(e,n){switch(e){case 0:return function(){return n.apply(this,arguments)};case 1:return function(e){return n.apply(this,arguments)};case 2:return function(e,t){return n.apply(this,arguments)};case 3:return function(e,t,r){return n.apply(this,arguments)};case 4:return function(e,t,r,o){return n.apply(this,arguments)};case 5:return function(e,t,r,o,a){return n.apply(this,arguments)};case 6:return function(e,t,r,o,a,c){return n.apply(this,arguments)};case 7:return function(e,t,r,o,a,c,i){return n.apply(this,arguments)};case 8:return function(e,t,r,o,a,c,i,u){return n.apply(this,arguments)};case 9:return function(e,t,r,o,a,c,i,u,s){return n.apply(this,arguments)};case 10:return function(e,t,r,o,a,c,i,u,s,l){return n.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}var h=l((function(e,n){return 1===e?s(n):f(e,function e(n,t,r){return function(){for(var o=[],a=0,c=n,i=0;i<t.length||a<arguments.length;){var s;i<t.length&&(!u(t[i])||a>=arguments.length)?s=t[i]:(s=arguments[a],a+=1),o[i]=s,u(s)||(c-=1),i+=1}return c<=0?r.apply(this,o):f(c,e(n,o,r))}}(e,[],n))}));function p(e){return function n(t,r,o){switch(arguments.length){case 0:return n;case 1:return u(t)?n:l((function(n,r){return e(t,n,r)}));case 2:return u(t)&&u(r)?n:u(t)?l((function(n,t){return e(n,r,t)})):u(r)?l((function(n,r){return e(t,n,r)})):s((function(n){return e(t,r,n)}));default:return u(t)&&u(r)&&u(o)?n:u(t)&&u(r)?l((function(n,t){return e(n,t,o)})):u(t)&&u(o)?l((function(n,t){return e(n,r,t)})):u(r)&&u(o)?l((function(n,r){return e(t,n,r)})):u(t)?s((function(n){return e(n,r,o)})):u(r)?s((function(n){return e(t,n,o)})):u(o)?s((function(n){return e(t,r,n)})):e(t,r,o)}}}var y=p((function(e,n,t){if(e>=t.length||e<-t.length)return t;var r=(e<0?t.length:0)+e,o=function(e,n){var t;n=n||[];var r=(e=e||[]).length,o=n.length,a=[];for(t=0;t<r;)a[a.length]=e[t],t+=1;for(t=0;t<o;)a[a.length]=n[t],t+=1;return a}(t);return o[r]=n(t[r]),o})),g=Array.isArray||function(e){return null!=e&&e.length>=0&&"[object Array]"===Object.prototype.toString.call(e)};function d(e){return"[object String]"===Object.prototype.toString.call(e)}var v=s((function(e){return!!g(e)||!!e&&("object"==typeof e&&(!d(e)&&(1===e.nodeType?!!e.length:0===e.length||e.length>0&&(e.hasOwnProperty(0)&&e.hasOwnProperty(e.length-1)))))})),b=function(){function e(e){this.f=e}return e.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},e.prototype["@@transducer/result"]=function(e){return e},e.prototype["@@transducer/step"]=function(e,n){return this.f(e,n)},e}();var m=l((function(e,n){return f(e.length,(function(){return e.apply(n,arguments)}))}));function A(e,n,t){for(var r=t.next();!r.done;){if((n=e["@@transducer/step"](n,r.value))&&n["@@transducer/reduced"]){n=n["@@transducer/value"];break}r=t.next()}return e["@@transducer/result"](n)}function O(e,n,t,r){return e["@@transducer/result"](t[r](m(e["@@transducer/step"],e),n))}var E="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator";function w(e,n,t){if("function"==typeof e&&(e=function(e){return new b(e)}(e)),v(t))return function(e,n,t){for(var r=0,o=t.length;r<o;){if((n=e["@@transducer/step"](n,t[r]))&&n["@@transducer/reduced"]){n=n["@@transducer/value"];break}r+=1}return e["@@transducer/result"](n)}(e,n,t);if("function"==typeof t["fantasy-land/reduce"])return O(e,n,t,"fantasy-land/reduce");if(null!=t[E])return A(e,n,t[E]());if("function"==typeof t.next)return A(e,n,t);if("function"==typeof t.reduce)return O(e,n,t,"reduce");throw new TypeError("reduce: list must be array or iterable")}function S(e,n){return Object.prototype.hasOwnProperty.call(n,e)}var L=Object.prototype.toString,k=function(){return"[object Arguments]"===L.call(arguments)?function(e){return"[object Arguments]"===L.call(e)}:function(e){return S("callee",e)}}(),_=!{toString:null}.propertyIsEnumerable("toString"),j=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],x=function(){return arguments.propertyIsEnumerable("length")}(),C=function(e,n){for(var t=0;t<e.length;){if(e[t]===n)return!0;t+=1}return!1},H="function"!=typeof Object.keys||x?s((function(e){if(Object(e)!==e)return[];var n,t,r=[],o=x&&k(e);for(n in e)!S(n,e)||o&&"length"===n||(r[r.length]=n);if(_)for(t=j.length-1;t>=0;)S(n=j[t],e)&&!C(r,n)&&(r[r.length]=n),t-=1;return r})):s((function(e){return Object(e)!==e?[]:Object.keys(e)})),T=p(w),q=s((function(e){return function(){return e}})),P=s((function(e){return h(e.length,e)})),R=s((function(e){return null===e?"Null":void 0===e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}));function M(e,n){return function(){return n.call(this,e.apply(this,arguments))}}function N(e,n){return function(){var t=arguments.length;if(0===t)return n();var r=arguments[t-1];return g(r)||"function"!=typeof r[e]?n.apply(this,arguments):r[e].apply(r,Array.prototype.slice.call(arguments,0,t-1))}}var D=p(N("slice",(function(e,n,t){return Array.prototype.slice.call(t,e,n)}))),U=s(N("tail",D(1,1/0)));function z(){if(0===arguments.length)throw new Error("pipe requires at least one argument");return f(arguments[0].length,T(M,arguments[0],U(arguments)))}var I=s((function(e){return d(e)?e.split("").reverse().join(""):Array.prototype.slice.call(e,0).reverse()}));function V(){if(0===arguments.length)throw new Error("compose requires at least one argument");return z.apply(this,I(arguments))}var W=l((function(e,n){var t=e<0?n.length+e:e;return d(n)?n.charAt(t):n[t]})),B=W(0);function F(e){for(var n,t=[];!(n=e.next()).done;)t.push(n.value);return t}function G(e,n,t){for(var r=0,o=t.length;r<o;){if(e(n,t[r]))return!0;r+=1}return!1}var X="function"==typeof Object.is?Object.is:function(e,n){return e===n?0!==e||1/e==1/n:e!=e&&n!=n};function Z(e,n,t,r){var o=F(e);function a(e,n){return Y(e,n,t.slice(),r.slice())}return!G((function(e,n){return!G(a,n,e)}),F(n),o)}function Y(e,n,t,r){if(X(e,n))return!0;var o,a,c=R(e);if(c!==R(n))return!1;if(null==e||null==n)return!1;if("function"==typeof e["fantasy-land/equals"]||"function"==typeof n["fantasy-land/equals"])return"function"==typeof e["fantasy-land/equals"]&&e["fantasy-land/equals"](n)&&"function"==typeof n["fantasy-land/equals"]&&n["fantasy-land/equals"](e);if("function"==typeof e.equals||"function"==typeof n.equals)return"function"==typeof e.equals&&e.equals(n)&&"function"==typeof n.equals&&n.equals(e);switch(c){case"Arguments":case"Array":case"Object":if("function"==typeof e.constructor&&"Promise"===(o=e.constructor,null==(a=String(o).match(/^function (\w*)/))?"":a[1]))return e===n;break;case"Boolean":case"Number":case"String":if(typeof e!=typeof n||!X(e.valueOf(),n.valueOf()))return!1;break;case"Date":if(!X(e.valueOf(),n.valueOf()))return!1;break;case"Error":return e.name===n.name&&e.message===n.message;case"RegExp":if(e.source!==n.source||e.global!==n.global||e.ignoreCase!==n.ignoreCase||e.multiline!==n.multiline||e.sticky!==n.sticky||e.unicode!==n.unicode)return!1}for(var i=t.length-1;i>=0;){if(t[i]===e)return r[i]===n;i-=1}switch(c){case"Map":return e.size===n.size&&Z(e.entries(),n.entries(),t.concat([e]),r.concat([n]));case"Set":return e.size===n.size&&Z(e.values(),n.values(),t.concat([e]),r.concat([n]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var u=H(e);if(u.length!==H(n).length)return!1;var s=t.concat([e]),l=r.concat([n]);for(i=u.length-1;i>=0;){var f=u[i];if(!S(f,n)||!Y(n[f],e[f],s,l))return!1;i-=1}return!0}var J=l((function(e,n){return Y(e,n,[],[])})),K=p((function(e,n,t){var r=Array.prototype.slice.call(t,0);return r.splice(e,n),r})),Q=p((function(e,n,t){return y(e,q(n),t)})),$=W(-1),ee={grid:{top:0,right:1,bottom:1,left:0},xAxis:{min:0,max:100,type:"value",splitLine:{show:!1},axisLine:{lineStyle:{color:"rgba(0,0,0,0)"},onZero:!1}},yAxis:{min:0,max:100,type:"value",splitLine:{show:!1},axisLine:{lineStyle:{color:"rgba(0,0,0,0)"},onZero:!1}},series:[]},ne=function(e){return[100*e.nativeEvent.offsetX/e.currentTarget.clientWidth,100*e.nativeEvent.offsetY/e.currentTarget.clientHeight]},te=function(e,n){var t,r;return 5-(t=e,r=n,Math.sqrt(Math.pow(Math.abs(t[0]-r[0]),2)+Math.pow(Math.abs(t[1]-r[1]),2)))<0?n:e},re=function(e){return J(B(e),$(e))},oe=function(e){return Q(-1,te(B(e),$(e)),e)},ae=function(e){return{anchors:[],color:e.color,over:!1,type:e.shapeType,data:e.data}};function ce(e,n){var t=n.type,r=n.location,o=n.newShapeList,a=n.shapeOrdinal,u=n.shapeType,s=n.anchorOrdinal,l=n.color,f=n.data,h=e.shapeList,p=h[e.selected];switch(t){case"CREATE_SHAPE":e={shapeList:i(h,[ae({shapeType:u||"line",color:l,data:f})]),selected:h.length};break;case"DELETE_SHAPE":if(void 0===a)break;e={shapeList:K(a,1,h),selected:0};break;case"CHANGE_SELECTED":if(void 0===a)break;e=c(c({},e),{selected:a});break;case"PUSH_ANCHOR":if(!p||p.over||!r)break;if(p.anchors.length<1&&p.anchors.push(r),"polygon"===p.type&&p.anchors.length>2&&(p.anchors=oe(p.anchors),p.over=re(p.anchors),p.over)){e=c({},e);break}if("sides"===p.type&&p.anchors.length>1){p.over=!0,e=c({},e);break}p.anchors.push(r),e=c({},e);break;case"MOVE_LAST_ANCHOR":p&&!p.over&&p.anchors.length>0&&(p.anchors=Q(-1,r,p.anchors),e=c({},e));break;case"MOVE_ANCHOR":p&&p.anchors.length>0&&"number"==typeof s&&(p.anchors=Q(s,r,p.anchors),"polygon"===p.type&&p.over&&n.anchorOrdinal===p.anchors.length-1&&(p.anchors=Q(0,r,p.anchors)),e=c({},e));break;case"OVER":if(p&&!p.over&&p.anchors.length>0){if(p.anchors=D(0,-2,p.anchors),"polygon"===p.type&&p.anchors.length>3&&(p.anchors=Q(-1,B(p.anchors),p.anchors)),"polygon"===p.type&&p.anchors.length<=3)break;if("line"===p.type&&p.anchors.length<2)break;p.over=!0,e=c({},e)}break;case"LOAD":e={selected:0,shapeList:o}}return e}export default function(i){var u=n(null),s=u[0],l=u[1],f=t(ce,{selected:0,shapeList:i.value}),h=f[0],p=f[1];ee.xAxis.splitLine.show=Boolean(i.showGrid),ee.yAxis.splitLine.show=Boolean(i.showGrid),r((function(){s&&s.setOption(c(c({},ee),{series:h.shapeList.map((function(e,n){return{type:"line",symbolSize:n===h.selected?14:0,data:e.anchors.map((function(e){return[e[0],100-e[1]]})),lineStyle:{color:e.color},itemStyle:{color:e.color},markLine:"sides"===e.type&&{symbol:["circle","triangle"],data:e.anchors[0]&&[[{coord:[(e.anchors[0][0]+e.anchors[1][0])/2-(e.anchors[0][1]-e.anchors[1][1])/4*(s._dom.clientHeight/s._dom.clientWidth),100-((e.anchors[0][1]+e.anchors[1][1])/2+(e.anchors[0][0]-e.anchors[1][0])/4*(s._dom.clientWidth/s._dom.clientHeight))]},{coord:[(e.anchors[0][0]+e.anchors[1][0])/2+(e.anchors[0][1]-e.anchors[1][1])/4*(s._dom.clientHeight/s._dom.clientWidth),100-((e.anchors[0][1]+e.anchors[1][1])/2-(e.anchors[0][0]-e.anchors[1][0])/4*(s._dom.clientWidth/s._dom.clientHeight))]}]]}}})),graphic:h.shapeList[h.selected]?a.util.map(h.shapeList[h.selected].anchors,(function(e,n){return{type:"circle",position:s.convertToPixel("grid",[e[0],100-e[1]]),shape:{cx:0,cy:0,r:5},invisible:!0,draggable:!0,ondrag:a.util.curry((function(e){var n=s.convertFromPixel("grid",this.position);p({type:"MOVE_ANCHOR",location:[n[0],100-n[1]],anchorOrdinal:e})}),n),z:100}})):null}),!0),i.onChange(h)}),[h]),r((function(){p({type:"CHANGE_SELECTED",shapeOrdinal:i.selected})}),[i.selected]),r((function(){i.onReady({createShape:g,deleteShape:d}),p({type:"LOAD",newShapeList:i.value})}),[s]),r((function(){J(h.shapeList,i.value)||p({type:"LOAD",newShapeList:i.value})}),[i.value]);var y=P((function(e,n){p({type:e,location:n})})),g=function(e){p({type:"CREATE_SHAPE",shapeType:e.shapeType,color:e.color,data:e.data})},d=function(e){p({type:"DELETE_SHAPE",shapeOrdinal:e})};return e.createElement("div",{style:{height:"100%",width:"100%"},onClick:V(y("PUSH_ANCHOR"),ne),onMouseMove:V(y("MOVE_LAST_ANCHOR"),ne),onDoubleClick:V(y("OVER"),ne)},e.createElement(o,{onChartReady:l,option:ee,style:{height:"100%",width:"100%"}}))}
